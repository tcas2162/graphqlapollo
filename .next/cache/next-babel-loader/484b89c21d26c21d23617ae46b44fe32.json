{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$(),\n    _jsxFileName = \"/Users/Tim/Desktop/graphqlapollo/components/context.js\",\n    _s2 = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { createContext, useContext, useState, useEffect } from 'react';\nimport Router from 'next/router';\nimport './firebase';\nimport { getAuth, signOut, signInWithPopup, GoogleAuthProvider } from 'firebase/auth';\nimport axios from 'axios';\nimport Cookies from 'js-cookie';\nvar AppContext = /*#__PURE__*/createContext();\nexport function context() {\n  _s();\n\n  return useContext(AppContext);\n}\n\n_s(context, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nexport function ContextProvider(_ref) {\n  _s2();\n\n  var children = _ref.children;\n\n  var _useState = useState(false),\n      user = _useState[0],\n      setUser = _useState[1];\n\n  var _useState2 = useState(true),\n      authenticationLoading = _useState2[0],\n      setAuthenticationLoading = _useState2[1];\n\n  var _useState3 = useState(false),\n      restaurantID = _useState3[0],\n      setRestaurantID = _useState3[1];\n\n  var _useState4 = useState([]),\n      cart = _useState4[0],\n      setCart = _useState4[1]; // remove cookies for testing.\n  // Cookies.remove('cart');\n  //// Authentication Section ////\n  // set up Firebase Goggle authentication\n\n\n  var auth = getAuth();\n  var provider = new GoogleAuthProvider(); // set Strapi URL\n\n  var API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || \"http://localhost:1337\"; // create an account\n\n  function createAccount(_x, _x2, _x3) {\n    return _createAccount.apply(this, arguments);\n  } // login\n\n\n  function _createAccount() {\n    _createAccount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(username, email, password) {\n      var errorResult;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!false) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 2:\n              errorResult = {};\n              _context.next = 5;\n              return axios.post(\"\".concat(API_URL, \"/auth/local/register\"), {\n                username: username,\n                email: email,\n                password: password\n              }).then(function (result) {\n                errorResult = {\n                  error: false\n                }; // Set user cookies\n\n                Cookies.set('strapiToken', result.data.jwt);\n                var userData = JSON.stringify(result.data.user);\n                Cookies.set('strapiUser', userData); // console.log('Context Strapi JWT: ', result.data.jwt);\n\n                console.log('Context Strapi Data: ', result.data);\n                setUser(result.data.user);\n              })[\"catch\"](function (error) {\n                console.warn(error);\n                errorResult = {\n                  error: true,\n                  data: 'The username or email you chose is already in use. Please try something else.'\n                };\n              });\n\n            case 5:\n              return _context.abrupt(\"return\", errorResult);\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _createAccount.apply(this, arguments);\n  }\n\n  function login(_x4, _x5) {\n    return _login.apply(this, arguments);\n  } // Strapi authentication after Google sign in\n\n\n  function _login() {\n    _login = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(identifier, password) {\n      var errorResult;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!false) {\n                _context2.next = 2;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 2:\n              _context2.next = 4;\n              return axios.post(\"\".concat(API_URL, \"/auth/local\"), {\n                identifier: identifier,\n                password: password\n              }).then(function (result) {\n                errorResult = {\n                  error: false\n                }; // Set user cookies\n\n                Cookies.set('strapiToken', result.data.jwt);\n                var userData = JSON.stringify(result.data.user);\n                Cookies.set('strapiUser', userData); // console.log('Context Strapi JWT: ', result.data.jwt);\n\n                console.log('Context Result Data', result.data);\n                setUser(result.data.user);\n                Router.push('/');\n              })[\"catch\"](function (error) {\n                console.warn(error);\n                errorResult = {\n                  error: true,\n                  data: 'Incorrect email or password'\n                };\n              });\n\n            case 4:\n              return _context2.abrupt(\"return\", errorResult);\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return _login.apply(this, arguments);\n  }\n\n  function strapiGoogleAuth(_x6) {\n    return _strapiGoogleAuth.apply(this, arguments);\n  } // sign in with Google\n\n\n  function _strapiGoogleAuth() {\n    _strapiGoogleAuth = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(accessToken) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!false) {\n                _context3.next = 2;\n                break;\n              }\n\n              return _context3.abrupt(\"return\");\n\n            case 2:\n              _context3.next = 4;\n              return axios.get(\"\".concat(API_URL, \"/auth/google/callback?access_token=\").concat(accessToken)).then(function (result) {\n                // console.log('Context Strapi JWT: ', result.data.jwt)\n                // Set user cookies\n                Cookies.set('strapiToken', result.data.jwt);\n                var userData = JSON.stringify(result.data.user);\n                Cookies.set('strapiUser', userData);\n                setUser(result.data.user);\n                console.log('Context Strapi Data: ', result.data);\n              })[\"catch\"](function (error) {\n                console.warn(error);\n              });\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n    return _strapiGoogleAuth.apply(this, arguments);\n  }\n\n  function googleSignIn() {\n    return _googleSignIn.apply(this, arguments);\n  } //logout\n\n\n  function _googleSignIn() {\n    _googleSignIn = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var errorResult;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (!false) {\n                _context4.next = 2;\n                break;\n              }\n\n              return _context4.abrupt(\"return\");\n\n            case 2:\n              _context4.next = 4;\n              return signInWithPopup(auth, provider).then(function (result) {\n                errorResult = {\n                  error: false\n                };\n                var userCredential = GoogleAuthProvider.credentialFromResult(result); // console.log('Context User Credential: ', userCredential);\n                // const token = credential.accessToken;\n                // console.log('Context Token: ', token);\n\n                console.log('Context Google Data: ', result);\n                strapiGoogleAuth(userCredential.accessToken);\n                Router.push('/');\n              })[\"catch\"](function (error) {\n                var credential = GoogleAuthProvider.credentialFromError(error);\n                errorResult = {\n                  error: true,\n                  data: error.code\n                };\n                console.warn('Credential From error: ', credential);\n                console.warn('Email: ', error.email);\n                console.warn(error.message);\n              });\n\n            case 4:\n              return _context4.abrupt(\"return\", errorResult);\n\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n    return _googleSignIn.apply(this, arguments);\n  }\n\n  function logOut() {\n    return _logOut.apply(this, arguments);\n  } //// Cart Section ////\n  // add item\n\n\n  function _logOut() {\n    _logOut = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return signOut(auth).then(function () {\n                Cookies.remove('strapiToken');\n                Cookies.remove('strapiUser');\n                setUser(false);\n                setCart([]);\n                Router.push('/');\n              })[\"catch\"](function (error) {\n                console.warn('Logout error: ', error);\n              });\n\n            case 2:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n    return _logOut.apply(this, arguments);\n  }\n\n  function addOneToCart(item) {\n    var newCart = cart;\n    var itemInCart = newCart.find(function (cartItem) {\n      return cartItem.id === item.id;\n    });\n\n    if (itemInCart !== undefined) {\n      var index = newCart.indexOf(itemInCart);\n      newCart[index].quantity++;\n      console.log('Context newCart add: ', newCart);\n    } else {\n      var newItem = _objectSpread({}, item);\n\n      newItem.quantity = 1;\n      newCart.push(newItem);\n      console.log('Context newCart add: ', newCart);\n    }\n\n    var cartData = JSON.stringify(newCart);\n    Cookies.set(\"\".concat(user.id, \"cart\"), cartData);\n    setCart(_toConsumableArray(newCart));\n  } // test for state change\n  // setTimeout(() => setCart([{id: 1234}, {id: 2345}, {id: 3456}]), 2000)\n  // remove item\n\n\n  function removeOneFromCart(item) {\n    var newCart = cart;\n    var itemInCart = newCart.find(function (cartItem) {\n      return cartItem.id === item.id;\n    });\n\n    if (itemInCart.quantity > 1) {\n      var index = newCart.indexOf(itemInCart);\n      newCart[index].quantity--;\n      console.log('Context newCart remove: ', newCart);\n    } else {\n      var _index = newCart.indexOf(item);\n\n      newCart.splice(_index, 1);\n      console.log('Context newCart remove: ', newCart);\n    }\n\n    setCart(_toConsumableArray(newCart)); // update/remove cart cookie\n\n    var cartData = JSON.stringify(newCart);\n\n    if (newCart.length === 0) {\n      Cookies.remove(\"\".concat(user.id, \"cart\"));\n    } else {\n      Cookies.set(\"\".concat(user.id, \"cart\"), cartData);\n    }\n  } // delete item\n\n\n  function deleteAllOfOneItemFromCart(item) {\n    var newCart = cart;\n    var index = newCart.indexOf(item);\n    newCart.splice(index, 1);\n    console.log('Context newCart delete: ', newCart);\n    setCart(_toConsumableArray(newCart)); // update/remove cart cookie\n\n    var cartData = JSON.stringify(newCart);\n\n    if (newCart.length === 0) {\n      Cookies.remove(\"\".concat(user.id, \"cart\"));\n    } else {\n      Cookies.set(\"\".concat(user.id, \"cart\"), cartData);\n    }\n  } //// Successful Checkout ////\n\n\n  function successfulCheckout() {\n    Cookies.remove(\"\".concat(user.id, \"cart\"));\n    setCart([]);\n  } //// Initial Setup ////\n  // check to see if the variable contains valid JSON data\n\n\n  function jsonDataTrue(string) {\n    var jsonData;\n\n    try {\n      jsonData = JSON.parse(string);\n    } catch (error) {\n      return false;\n    }\n\n    return jsonData;\n  } // change restaurant id for dishes page.\n\n\n  function changeRestaurantID(id) {\n    setRestaurantID(id);\n  } // check cookies for existing session data\n\n\n  useEffect(function () {\n    // get authentication and authorization data from session cookies\n    var strapiUserData = Cookies.get('strapiUser');\n    var strapiUserDataObject = jsonDataTrue(strapiUserData);\n\n    if (strapiUserDataObject) {\n      console.log('Context Strapi User: ', strapiUserDataObject);\n      setUser(_objectSpread({}, strapiUserDataObject));\n    }\n\n    setAuthenticationLoading(false);\n  }, []);\n  useEffect(function () {\n    // get cart data from session cookie\n    var cartData = Cookies.get(\"\".concat(user.id, \"cart\"));\n    var cartDataObject = jsonDataTrue(cartData);\n\n    if (cartDataObject) {\n      setCart(_toConsumableArray(cartDataObject));\n    }\n  }, [user]); //// Context Values ////\n\n  var contextValues = {\n    user: user,\n    authenticationLoading: authenticationLoading,\n    createAccount: createAccount,\n    login: login,\n    googleSignIn: googleSignIn,\n    logOut: logOut,\n    restaurantID: restaurantID,\n    changeRestaurantID: changeRestaurantID,\n    cart: cart,\n    addOneToCart: addOneToCart,\n    removeOneFromCart: removeOneFromCart,\n    deleteAllOfOneItemFromCart: deleteAllOfOneItemFromCart,\n    successfulCheckout: successfulCheckout\n  }; //// Context Provider ////\n\n  return __jsx(AppContext.Provider, {\n    value: contextValues,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 5\n    }\n  }, children);\n}\n\n_s2(ContextProvider, \"BS1Cpxi9hYJimBEyi+zAKlr69hs=\");\n\n_c = ContextProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"ContextProvider\");","map":{"version":3,"sources":["/Users/Tim/Desktop/graphqlapollo/components/context.js"],"names":["createContext","useContext","useState","useEffect","Router","getAuth","signOut","signInWithPopup","GoogleAuthProvider","axios","Cookies","AppContext","context","ContextProvider","children","user","setUser","authenticationLoading","setAuthenticationLoading","restaurantID","setRestaurantID","cart","setCart","auth","provider","API_URL","process","env","NEXT_PUBLIC_STRAPI_API_URL","createAccount","username","email","password","errorResult","post","then","result","error","set","data","jwt","userData","JSON","stringify","console","log","warn","login","identifier","push","strapiGoogleAuth","accessToken","get","googleSignIn","userCredential","credentialFromResult","credential","credentialFromError","code","message","logOut","remove","addOneToCart","item","newCart","itemInCart","find","cartItem","id","undefined","index","indexOf","quantity","newItem","cartData","removeOneFromCart","splice","length","deleteAllOfOneItemFromCart","successfulCheckout","jsonDataTrue","string","jsonData","parse","changeRestaurantID","strapiUserData","strapiUserDataObject","cartDataObject","contextValues"],"mappings":"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","sourcesContent":["import { createContext, useContext, useState, useEffect } from 'react';\nimport Router from 'next/router';\nimport './firebase';\nimport { \n  getAuth, \n  signOut,\n  signInWithPopup,\n  GoogleAuthProvider\n} from 'firebase/auth';\nimport axios from 'axios';\nimport Cookies from 'js-cookie';\nconst AppContext = createContext();\n\nexport function context() {\n  return useContext(AppContext);\n}\n\nexport function ContextProvider({ children }) {\n  const [user, setUser] = useState(false);\n  const [authenticationLoading, setAuthenticationLoading] = useState(true);\n  const [restaurantID, setRestaurantID] = useState(false);\n  const [cart, setCart] = useState([]);\n\n  // remove cookies for testing.\n  // Cookies.remove('cart');\n\n  //// Authentication Section ////\n  // set up Firebase Goggle authentication\n  const auth = getAuth();\n  const provider = new GoogleAuthProvider();\n\n  // set Strapi URL\n  const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || \"http://localhost:1337\";\n\n  // create an account\n  async function createAccount(username, email, password) {\n    // prevent this function from being run on a server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    let errorResult = {};\n\n    await axios\n      .post(`${API_URL}/auth/local/register`, { username, email, password })\n      .then(result => {\n        errorResult = { error: false };\n        // Set user cookies\n        Cookies.set('strapiToken', result.data.jwt);\n        const userData = JSON.stringify(result.data.user);\n        Cookies.set('strapiUser', userData);\n        // console.log('Context Strapi JWT: ', result.data.jwt);\n        console.log('Context Strapi Data: ', result.data);\n        setUser(result.data.user);\n      })\n      .catch(error => {\n        console.warn(error);\n        errorResult = { error: true, data: 'The username or email you chose is already in use. Please try something else.' };\n      })\n\n    return errorResult;\n  }\n\n  // login\n  async function login(identifier, password) {\n    // prevent this function from being run on a server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    let errorResult;\n\n    await axios\n      .post(`${API_URL}/auth/local`, { identifier, password })\n      .then(result => {\n        errorResult = { error: false };\n        // Set user cookies\n        Cookies.set('strapiToken', result.data.jwt);\n        const userData = JSON.stringify(result.data.user);\n        Cookies.set('strapiUser', userData);\n        // console.log('Context Strapi JWT: ', result.data.jwt);\n        console.log('Context Result Data', result.data);\n        setUser(result.data.user);\n        Router.push('/');\n      })\n      .catch(error => {\n        console.warn(error);\n        errorResult = { error: true, data: 'Incorrect email or password' };\n      })\n\n    return errorResult;\n  }\n\n  // Strapi authentication after Google sign in\n  async function strapiGoogleAuth(accessToken) {\n    // prevent this function from being run on a server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    await axios\n      .get(`${API_URL}/auth/google/callback?access_token=${accessToken}`)\n      .then((result) => {\n        // console.log('Context Strapi JWT: ', result.data.jwt)\n        // Set user cookies\n        Cookies.set('strapiToken', result.data.jwt);\n        const userData = JSON.stringify(result.data.user);\n        Cookies.set('strapiUser', userData);\n        setUser(result.data.user);\n        console.log('Context Strapi Data: ', result.data);\n      })\n      .catch(error => {\n        console.warn(error);\n      })\n  }\n\n  // sign in with Google\n  async function googleSignIn() {\n    // prevent this function from being run on a server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    let errorResult;\n\n    await signInWithPopup(auth, provider)\n      .then(result => {\n        errorResult = { error: false }\n        const userCredential = GoogleAuthProvider.credentialFromResult(result);\n        // console.log('Context User Credential: ', userCredential);\n        // const token = credential.accessToken;\n        // console.log('Context Token: ', token);\n        console.log('Context Google Data: ', result);\n        strapiGoogleAuth(userCredential.accessToken)\n        Router.push('/');\n      })\n      .catch(error => {\n        const credential = GoogleAuthProvider.credentialFromError(error);\n        errorResult = { error: true, data: error.code };\n        console.warn('Credential From error: ', credential)\n        console.warn('Email: ', error.email)\n        console.warn(error.message);\n      })\n\n    return errorResult;\n  }\n\n  //logout\n  async function logOut() {\n    await signOut(auth)\n      .then(() => {\n        Cookies.remove('strapiToken');\n        Cookies.remove('strapiUser');\n        setUser(false);\n        setCart([]);\n        Router.push('/');\n      })\n      .catch((error) => {\n        console.warn('Logout error: ', error);\n      });\n  }\n\n\n  //// Cart Section ////\n  // add item\n  function addOneToCart(item) {\n    let newCart = cart;\n    const itemInCart = newCart.find(cartItem => cartItem.id === item.id);\n    if (itemInCart !== undefined) {\n      const index = newCart.indexOf(itemInCart);\n      newCart[index].quantity ++;\n      console.log('Context newCart add: ', newCart);\n    } else {\n      let newItem = {...item};\n      newItem.quantity = 1;\n      newCart.push(newItem);\n      console.log('Context newCart add: ', newCart);\n    }\n    const cartData = JSON.stringify(newCart);\n    Cookies.set(`${user.id}cart`, cartData)\n    setCart([...newCart]);\n  }\n\n  // test for state change\n  // setTimeout(() => setCart([{id: 1234}, {id: 2345}, {id: 3456}]), 2000)\n\n  // remove item\n  function removeOneFromCart(item) {\n    let newCart = cart;\n    const itemInCart = newCart.find(cartItem => cartItem.id === item.id);\n    if (itemInCart.quantity > 1) {\n      const index = newCart.indexOf(itemInCart);\n      newCart[index].quantity --;\n      console.log('Context newCart remove: ', newCart);\n    } else {\n      const index = newCart.indexOf(item);\n      newCart.splice(index, 1);\n      console.log('Context newCart remove: ', newCart);\n    }\n    setCart([...newCart]);\n\n    // update/remove cart cookie\n    const cartData = JSON.stringify(newCart);\n    if (newCart.length === 0) {\n      Cookies.remove(`${user.id}cart`);\n    } else {\n      Cookies.set(`${user.id}cart`, cartData);\n    }\n  }\n\n  // delete item\n  function deleteAllOfOneItemFromCart(item) {\n    let newCart = cart;\n    const index = newCart.indexOf(item);\n    newCart.splice(index, 1);\n    console.log('Context newCart delete: ', newCart)\n    setCart([...newCart]);\n\n    // update/remove cart cookie\n    const cartData = JSON.stringify(newCart);\n    if (newCart.length === 0) {\n      Cookies.remove(`${user.id}cart`);\n    } else {\n      Cookies.set(`${user.id}cart`, cartData);\n    }\n  }\n\n  //// Successful Checkout ////\n  function successfulCheckout() {\n    Cookies.remove(`${user.id}cart`);\n    setCart([]);\n  }\n\n  //// Initial Setup ////\n  // check to see if the variable contains valid JSON data\n  function jsonDataTrue(string) {\n    let jsonData;\n    try {\n      jsonData = JSON.parse(string);\n    } catch (error) {\n      return false;\n    }\n    return jsonData;\n  }\n\n  // change restaurant id for dishes page.\n  function changeRestaurantID(id) {\n    setRestaurantID(id);\n  }\n\n  // check cookies for existing session data\n  useEffect(() => {\n    // get authentication and authorization data from session cookies\n    const strapiUserData = Cookies.get('strapiUser');\n    const strapiUserDataObject = jsonDataTrue(strapiUserData);\n    if (strapiUserDataObject) {\n      console.log('Context Strapi User: ', strapiUserDataObject);\n      setUser({...strapiUserDataObject});\n    }\n\n    setAuthenticationLoading(false);\n  }, []);\n\n  useEffect(() => {\n    // get cart data from session cookie\n    const cartData = Cookies.get(`${user.id}cart`);\n    const cartDataObject = jsonDataTrue(cartData);\n    if (cartDataObject) {\n      setCart([...cartDataObject]);\n    }\n  }, [user]);\n\n  //// Context Values ////\n  const contextValues = {\n    user,\n    authenticationLoading,\n    createAccount,\n    login,\n    googleSignIn,\n    logOut,\n    restaurantID,\n    changeRestaurantID,\n    cart,\n    addOneToCart,\n    removeOneFromCart,\n    deleteAllOfOneItemFromCart,\n    successfulCheckout\n  }\n\n  //// Context Provider ////\n  return (\n    <AppContext.Provider value={ contextValues }>\n      {children}\n    </AppContext.Provider>\n  );\n}"]},"metadata":{},"sourceType":"module"}