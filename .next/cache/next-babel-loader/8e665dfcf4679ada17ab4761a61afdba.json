{"ast":null,"code":"var _jsxFileName = \"/Users/Tim/Desktop/graphqlapollo/components/context.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { createContext, useContext, useState, useEffect } from 'react';\nimport Router from 'next/router';\nimport './firebase';\nimport { getAuth, signOut, signInWithPopup, GoogleAuthProvider } from 'firebase/auth';\nimport axios from 'axios';\nimport Cookies from 'js-cookie';\nconst AppContext = /*#__PURE__*/createContext();\nexport function context() {\n  return useContext(AppContext);\n}\nexport function ContextProvider({\n  children\n}) {\n  const {\n    0: user,\n    1: setUser\n  } = useState(false);\n  const {\n    0: authenticationLoading,\n    1: setAuthenticationLoading\n  } = useState(true);\n  const {\n    0: restaurantID,\n    1: setRestaurantID\n  } = useState(false);\n  const {\n    0: cart,\n    1: setCart\n  } = useState([]); // remove cookies for testing.\n  // Cookies.remove('cart');\n  //// Authentication Section ////\n  // set up Firebase Goggle authentication\n\n  const auth = getAuth();\n  const provider = new GoogleAuthProvider(); // set Strapi URL\n\n  const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || \"http://localhost:1337\"; // create an account\n\n  async function createAccount(username, email, password) {\n    // prevent this function from being run on a server\n    if (true) {\n      return;\n    }\n\n    let errorResult = {};\n    await axios.post(`${API_URL}/auth/local/register`, {\n      username,\n      email,\n      password\n    }).then(result => {\n      errorResult = {\n        error: false\n      }; // Set user cookies\n\n      Cookies.set('strapiToken', result.data.jwt);\n      const userData = JSON.stringify(result.data.user);\n      Cookies.set('strapiUser', userData); // console.log('Context Strapi JWT: ', result.data.jwt);\n\n      console.log('Context Strapi Data: ', result.data);\n      setUser(result.data.user);\n    }).catch(error => {\n      console.warn(error);\n      errorResult = {\n        error: true,\n        data: 'The username or email you chose is already in use. Please try something else.'\n      };\n    });\n    return errorResult;\n  } // login\n\n\n  async function login(identifier, password) {\n    // prevent this function from being run on a server\n    if (true) {\n      return;\n    }\n\n    let errorResult;\n    await axios.post(`${API_URL}/auth/local`, {\n      identifier,\n      password\n    }).then(result => {\n      errorResult = {\n        error: false\n      }; // Set user cookies\n\n      Cookies.set('strapiToken', result.data.jwt);\n      const userData = JSON.stringify(result.data.user);\n      Cookies.set('strapiUser', userData); // console.log('Context Strapi JWT: ', result.data.jwt);\n\n      console.log('Context Result Data', result.data);\n      setUser(result.data.user);\n      Router.push('/');\n    }).catch(error => {\n      console.warn(error);\n      errorResult = {\n        error: true,\n        data: 'Incorrect email or password'\n      };\n    });\n    return errorResult;\n  } // Strapi authentication after Google sign in\n\n\n  async function strapiGoogleAuth(accessToken) {\n    // prevent this function from being run on a server\n    if (true) {\n      return;\n    }\n\n    await axios.get(`${API_URL}/auth/google/callback?access_token=${accessToken}`).then(result => {\n      // console.log('Context Strapi JWT: ', result.data.jwt)\n      // Set user cookies\n      Cookies.set('strapiToken', result.data.jwt);\n      const userData = JSON.stringify(result.data.user);\n      Cookies.set('strapiUser', userData);\n      setUser(result.data.user);\n      console.log('Context Strapi Data: ', result.data);\n    }).catch(error => {\n      console.warn(error);\n    });\n  } // sign in with Google\n\n\n  async function googleSignIn() {\n    // prevent this function from being run on a server\n    if (true) {\n      return;\n    }\n\n    let errorResult;\n    await signInWithPopup(auth, provider).then(result => {\n      errorResult = {\n        error: false\n      };\n      const userCredential = GoogleAuthProvider.credentialFromResult(result); // console.log('Context User Credential: ', userCredential);\n      // const token = credential.accessToken;\n      // console.log('Context Token: ', token);\n\n      console.log('Context Google Data: ', result);\n      strapiGoogleAuth(userCredential.accessToken);\n      Router.push('/');\n    }).catch(error => {\n      const credential = GoogleAuthProvider.credentialFromError(error);\n      errorResult = {\n        error: true,\n        data: error.code\n      };\n      console.warn('Credential From error: ', credential);\n      console.warn('Email: ', error.email);\n      console.warn(error.message);\n    });\n    return errorResult;\n  } //logout\n\n\n  async function logOut() {\n    await signOut(auth).then(() => {\n      Cookies.remove('strapiToken');\n      Cookies.remove('strapiUser');\n      setUser(false);\n      setCart([]);\n      Router.push('/');\n    }).catch(error => {\n      console.warn('Logout error: ', error);\n    });\n  } //// Cart Section ////\n  // add item\n\n\n  function addOneToCart(item) {\n    let newCart = cart;\n    const itemInCart = newCart.find(cartItem => cartItem.id === item.id);\n\n    if (itemInCart !== undefined) {\n      const index = newCart.indexOf(itemInCart);\n      newCart[index].quantity++;\n      console.log('Context newCart add: ', newCart);\n    } else {\n      let newItem = _objectSpread({}, item);\n\n      newItem.quantity = 1;\n      newCart.push(newItem);\n      console.log('Context newCart add: ', newCart);\n    }\n\n    const cartData = JSON.stringify(newCart);\n    Cookies.set(`${user.id}cart`, cartData);\n    setCart([...newCart]);\n  } // test for state change\n  // setTimeout(() => setCart([{id: 1234}, {id: 2345}, {id: 3456}]), 2000)\n  // remove item\n\n\n  function removeOneFromCart(item) {\n    let newCart = cart;\n    const itemInCart = newCart.find(cartItem => cartItem.id === item.id);\n\n    if (itemInCart.quantity > 1) {\n      const index = newCart.indexOf(itemInCart);\n      newCart[index].quantity--;\n      console.log('Context newCart remove: ', newCart);\n    } else {\n      const index = newCart.indexOf(item);\n      newCart.splice(index, 1);\n      console.log('Context newCart remove: ', newCart);\n    }\n\n    setCart([...newCart]); // update/remove cart cookie\n\n    const cartData = JSON.stringify(newCart);\n\n    if (newCart.length === 0) {\n      Cookies.remove(`${user.id}cart`);\n    } else {\n      Cookies.set(`${user.id}cart`, cartData);\n    }\n  } // delete item\n\n\n  function deleteAllOfOneItemFromCart(item) {\n    let newCart = cart;\n    const index = newCart.indexOf(item);\n    newCart.splice(index, 1);\n    console.log('Context newCart delete: ', newCart);\n    setCart([...newCart]); // update/remove cart cookie\n\n    const cartData = JSON.stringify(newCart);\n\n    if (newCart.length === 0) {\n      Cookies.remove(`${user.id}cart`);\n    } else {\n      Cookies.set(`${user.id}cart`, cartData);\n    }\n  } //// Successful Checkout ////\n\n\n  function successfulCheckout() {\n    Cookies.remove(`${user.id}cart`);\n    setCart([]);\n  } //// Initial Setup ////\n  // check to see if the variable contains valid JSON data\n\n\n  function jsonDataTrue(string) {\n    let jsonData;\n\n    try {\n      jsonData = JSON.parse(string);\n    } catch (error) {\n      return false;\n    }\n\n    return jsonData;\n  } // change restaurant id for dishes page.\n\n\n  function changeRestaurantID(id) {\n    setRestaurantID(id);\n  } // check cookies for existing session data\n\n\n  useEffect(() => {\n    // get authentication and authorization data from session cookies\n    const strapiUserData = Cookies.get('strapiUser');\n    const strapiUserDataObject = jsonDataTrue(strapiUserData);\n\n    if (strapiUserDataObject) {\n      console.log('Context Strapi User: ', strapiUserDataObject);\n      setUser(_objectSpread({}, strapiUserDataObject));\n    }\n\n    setAuthenticationLoading(false);\n  }, []);\n  useEffect(() => {\n    // get cart data from session cookie\n    const cartData = Cookies.get(`${user.id}cart`);\n    const cartDataObject = jsonDataTrue(cartData);\n\n    if (cartDataObject) {\n      setCart([...cartDataObject]);\n    }\n  }, [user]); //// Context Values ////\n\n  const contextValues = {\n    user,\n    authenticationLoading,\n    createAccount,\n    login,\n    googleSignIn,\n    logOut,\n    restaurantID,\n    changeRestaurantID,\n    cart,\n    addOneToCart,\n    removeOneFromCart,\n    deleteAllOfOneItemFromCart,\n    successfulCheckout\n  }; //// Context Provider ////\n\n  return __jsx(AppContext.Provider, {\n    value: contextValues,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 5\n    }\n  }, children);\n}","map":{"version":3,"sources":["/Users/Tim/Desktop/graphqlapollo/components/context.js"],"names":["createContext","useContext","useState","useEffect","Router","getAuth","signOut","signInWithPopup","GoogleAuthProvider","axios","Cookies","AppContext","context","ContextProvider","children","user","setUser","authenticationLoading","setAuthenticationLoading","restaurantID","setRestaurantID","cart","setCart","auth","provider","API_URL","process","env","NEXT_PUBLIC_STRAPI_API_URL","createAccount","username","email","password","errorResult","post","then","result","error","set","data","jwt","userData","JSON","stringify","console","log","catch","warn","login","identifier","push","strapiGoogleAuth","accessToken","get","googleSignIn","userCredential","credentialFromResult","credential","credentialFromError","code","message","logOut","remove","addOneToCart","item","newCart","itemInCart","find","cartItem","id","undefined","index","indexOf","quantity","newItem","cartData","removeOneFromCart","splice","length","deleteAllOfOneItemFromCart","successfulCheckout","jsonDataTrue","string","jsonData","parse","changeRestaurantID","strapiUserData","strapiUserDataObject","cartDataObject","contextValues"],"mappings":"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","sourcesContent":["import { createContext, useContext, useState, useEffect } from 'react';\nimport Router from 'next/router';\nimport './firebase';\nimport { \n  getAuth, \n  signOut,\n  signInWithPopup,\n  GoogleAuthProvider\n} from 'firebase/auth';\nimport axios from 'axios';\nimport Cookies from 'js-cookie';\nconst AppContext = createContext();\n\nexport function context() {\n  return useContext(AppContext);\n}\n\nexport function ContextProvider({ children }) {\n  const [user, setUser] = useState(false);\n  const [authenticationLoading, setAuthenticationLoading] = useState(true);\n  const [restaurantID, setRestaurantID] = useState(false);\n  const [cart, setCart] = useState([]);\n\n  // remove cookies for testing.\n  // Cookies.remove('cart');\n\n  //// Authentication Section ////\n  // set up Firebase Goggle authentication\n  const auth = getAuth();\n  const provider = new GoogleAuthProvider();\n\n  // set Strapi URL\n  const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || \"http://localhost:1337\";\n\n  // create an account\n  async function createAccount(username, email, password) {\n    // prevent this function from being run on a server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    let errorResult = {};\n\n    await axios\n      .post(`${API_URL}/auth/local/register`, { username, email, password })\n      .then(result => {\n        errorResult = { error: false };\n        // Set user cookies\n        Cookies.set('strapiToken', result.data.jwt);\n        const userData = JSON.stringify(result.data.user);\n        Cookies.set('strapiUser', userData);\n        // console.log('Context Strapi JWT: ', result.data.jwt);\n        console.log('Context Strapi Data: ', result.data);\n        setUser(result.data.user);\n      })\n      .catch(error => {\n        console.warn(error);\n        errorResult = { error: true, data: 'The username or email you chose is already in use. Please try something else.' };\n      })\n\n    return errorResult;\n  }\n\n  // login\n  async function login(identifier, password) {\n    // prevent this function from being run on a server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    let errorResult;\n\n    await axios\n      .post(`${API_URL}/auth/local`, { identifier, password })\n      .then(result => {\n        errorResult = { error: false };\n        // Set user cookies\n        Cookies.set('strapiToken', result.data.jwt);\n        const userData = JSON.stringify(result.data.user);\n        Cookies.set('strapiUser', userData);\n        // console.log('Context Strapi JWT: ', result.data.jwt);\n        console.log('Context Result Data', result.data);\n        setUser(result.data.user);\n        Router.push('/');\n      })\n      .catch(error => {\n        console.warn(error);\n        errorResult = { error: true, data: 'Incorrect email or password' };\n      })\n\n    return errorResult;\n  }\n\n  // Strapi authentication after Google sign in\n  async function strapiGoogleAuth(accessToken) {\n    // prevent this function from being run on a server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    await axios\n      .get(`${API_URL}/auth/google/callback?access_token=${accessToken}`)\n      .then((result) => {\n        // console.log('Context Strapi JWT: ', result.data.jwt)\n        // Set user cookies\n        Cookies.set('strapiToken', result.data.jwt);\n        const userData = JSON.stringify(result.data.user);\n        Cookies.set('strapiUser', userData);\n        setUser(result.data.user);\n        console.log('Context Strapi Data: ', result.data);\n      })\n      .catch(error => {\n        console.warn(error);\n      })\n  }\n\n  // sign in with Google\n  async function googleSignIn() {\n    // prevent this function from being run on a server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    let errorResult;\n\n    await signInWithPopup(auth, provider)\n      .then(result => {\n        errorResult = { error: false }\n        const userCredential = GoogleAuthProvider.credentialFromResult(result);\n        // console.log('Context User Credential: ', userCredential);\n        // const token = credential.accessToken;\n        // console.log('Context Token: ', token);\n        console.log('Context Google Data: ', result);\n        strapiGoogleAuth(userCredential.accessToken)\n        Router.push('/');\n      })\n      .catch(error => {\n        const credential = GoogleAuthProvider.credentialFromError(error);\n        errorResult = { error: true, data: error.code };\n        console.warn('Credential From error: ', credential)\n        console.warn('Email: ', error.email)\n        console.warn(error.message);\n      })\n\n    return errorResult;\n  }\n\n  //logout\n  async function logOut() {\n    await signOut(auth)\n      .then(() => {\n        Cookies.remove('strapiToken');\n        Cookies.remove('strapiUser');\n        setUser(false);\n        setCart([]);\n        Router.push('/');\n      })\n      .catch((error) => {\n        console.warn('Logout error: ', error);\n      });\n  }\n\n\n  //// Cart Section ////\n  // add item\n  function addOneToCart(item) {\n    let newCart = cart;\n    const itemInCart = newCart.find(cartItem => cartItem.id === item.id);\n    if (itemInCart !== undefined) {\n      const index = newCart.indexOf(itemInCart);\n      newCart[index].quantity ++;\n      console.log('Context newCart add: ', newCart);\n    } else {\n      let newItem = {...item};\n      newItem.quantity = 1;\n      newCart.push(newItem);\n      console.log('Context newCart add: ', newCart);\n    }\n    const cartData = JSON.stringify(newCart);\n    Cookies.set(`${user.id}cart`, cartData)\n    setCart([...newCart]);\n  }\n\n  // test for state change\n  // setTimeout(() => setCart([{id: 1234}, {id: 2345}, {id: 3456}]), 2000)\n\n  // remove item\n  function removeOneFromCart(item) {\n    let newCart = cart;\n    const itemInCart = newCart.find(cartItem => cartItem.id === item.id);\n    if (itemInCart.quantity > 1) {\n      const index = newCart.indexOf(itemInCart);\n      newCart[index].quantity --;\n      console.log('Context newCart remove: ', newCart);\n    } else {\n      const index = newCart.indexOf(item);\n      newCart.splice(index, 1);\n      console.log('Context newCart remove: ', newCart);\n    }\n    setCart([...newCart]);\n\n    // update/remove cart cookie\n    const cartData = JSON.stringify(newCart);\n    if (newCart.length === 0) {\n      Cookies.remove(`${user.id}cart`);\n    } else {\n      Cookies.set(`${user.id}cart`, cartData);\n    }\n  }\n\n  // delete item\n  function deleteAllOfOneItemFromCart(item) {\n    let newCart = cart;\n    const index = newCart.indexOf(item);\n    newCart.splice(index, 1);\n    console.log('Context newCart delete: ', newCart)\n    setCart([...newCart]);\n\n    // update/remove cart cookie\n    const cartData = JSON.stringify(newCart);\n    if (newCart.length === 0) {\n      Cookies.remove(`${user.id}cart`);\n    } else {\n      Cookies.set(`${user.id}cart`, cartData);\n    }\n  }\n\n  //// Successful Checkout ////\n  function successfulCheckout() {\n    Cookies.remove(`${user.id}cart`);\n    setCart([]);\n  }\n\n  //// Initial Setup ////\n  // check to see if the variable contains valid JSON data\n  function jsonDataTrue(string) {\n    let jsonData;\n    try {\n      jsonData = JSON.parse(string);\n    } catch (error) {\n      return false;\n    }\n    return jsonData;\n  }\n\n  // change restaurant id for dishes page.\n  function changeRestaurantID(id) {\n    setRestaurantID(id);\n  }\n\n  // check cookies for existing session data\n  useEffect(() => {\n    // get authentication and authorization data from session cookies\n    const strapiUserData = Cookies.get('strapiUser');\n    const strapiUserDataObject = jsonDataTrue(strapiUserData);\n    if (strapiUserDataObject) {\n      console.log('Context Strapi User: ', strapiUserDataObject);\n      setUser({...strapiUserDataObject});\n    }\n\n    setAuthenticationLoading(false);\n  }, []);\n\n  useEffect(() => {\n    // get cart data from session cookie\n    const cartData = Cookies.get(`${user.id}cart`);\n    const cartDataObject = jsonDataTrue(cartData);\n    if (cartDataObject) {\n      setCart([...cartDataObject]);\n    }\n  }, [user]);\n\n  //// Context Values ////\n  const contextValues = {\n    user,\n    authenticationLoading,\n    createAccount,\n    login,\n    googleSignIn,\n    logOut,\n    restaurantID,\n    changeRestaurantID,\n    cart,\n    addOneToCart,\n    removeOneFromCart,\n    deleteAllOfOneItemFromCart,\n    successfulCheckout\n  }\n\n  //// Context Provider ////\n  return (\n    <AppContext.Provider value={ contextValues }>\n      {children}\n    </AppContext.Provider>\n  );\n}"]},"metadata":{},"sourceType":"module"}