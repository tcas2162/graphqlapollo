{"ast":null,"code":"var _jsxFileName = \"/Users/Tim/Desktop/graphqlapollo/components/context.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { createContext, useContext, useState, useEffect } from 'react';\nexport function context() {\n  return useContext(AppContext);\n}\nexport function ContextProvider({\n  children\n}) {\n  const {\n    0: user,\n    1: setUser\n  } = useState(false);\n  const {\n    0: authenticationLoading,\n    1: setAuthenticationLoading\n  } = useState(true);\n  const {\n    0: restaurantID,\n    1: setRestaurantID\n  } = useState(false);\n  const {\n    0: cart,\n    1: setCart\n  } = useState([]); // remove cookies for testing.\n  // Cookies.remove('cart');\n  //// Authentication Section ////\n  // set up Firebase Goggle authentication\n\n  const auth = getAuth();\n  const provider = new GoogleAuthProvider(); // set Strapi URL\n\n  const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || \"http://localhost:1337\"; // create an account\n\n  async function createAccount(username, email, password) {\n    // prevent this function from being run on a server\n    if (true) {\n      return;\n    }\n\n    let errorResult = {};\n    await axios.post(`${API_URL}/auth/local/register`, {\n      username,\n      email,\n      password\n    }).then(result => {\n      errorResult = {\n        error: false\n      }; // Set user cookies\n\n      Cookies.set('strapiToken', result.data.jwt);\n      const userData = JSON.stringify(result.data.user);\n      Cookies.set('strapiUser', userData); // console.log('Context Strapi JWT: ', result.data.jwt);\n\n      console.log('Context Strapi Data: ', result.data);\n      setUser(result.data.user);\n    }).catch(error => {\n      console.warn(error);\n      errorResult = {\n        error: true,\n        data: 'The username or email you chose is already in use. Please try something else.'\n      };\n    });\n    return errorResult;\n  } // login\n\n\n  async function login(identifier, password) {\n    // prevent this function from being run on a server\n    if (true) {\n      return;\n    }\n\n    let errorResult;\n    await axios.post(`${API_URL}/auth/local`, {\n      identifier,\n      password\n    }).then(result => {\n      errorResult = {\n        error: false\n      }; // Set user cookies\n\n      Cookies.set('strapiToken', result.data.jwt);\n      const userData = JSON.stringify(result.data.user);\n      Cookies.set('strapiUser', userData); // console.log('Context Strapi JWT: ', result.data.jwt);\n\n      console.log('Context Result Data', result.data);\n      setUser(result.data.user);\n      Router.push('/');\n    }).catch(error => {\n      console.warn(error);\n      errorResult = {\n        error: true,\n        data: 'Incorrect email or password'\n      };\n    });\n    return errorResult;\n  } // Strapi authentication after Google sign in\n\n\n  async function strapiGoogleAuth(accessToken) {\n    // prevent this function from being run on a server\n    if (true) {\n      return;\n    }\n\n    await axios.get(`${API_URL}/auth/google/callback?access_token=${accessToken}`).then(result => {\n      // console.log('Context Strapi JWT: ', result.data.jwt)\n      // Set user cookies\n      Cookies.set('strapiToken', result.data.jwt);\n      const userData = JSON.stringify(result.data.user);\n      Cookies.set('strapiUser', userData);\n      setUser(result.data.user);\n      console.log('Context Strapi Data: ', result.data);\n    }).catch(error => {\n      console.warn(error);\n    });\n  } // sign in with Google\n\n\n  async function googleSignIn() {\n    // prevent this function from being run on a server\n    if (true) {\n      return;\n    }\n\n    let errorResult;\n    await signInWithPopup(auth, provider).then(result => {\n      errorResult = {\n        error: false\n      };\n      const userCredential = GoogleAuthProvider.credentialFromResult(result); // console.log('Context User Credential: ', userCredential);\n      // const token = credential.accessToken;\n      // console.log('Context Token: ', token);\n\n      console.log('Context Google Data: ', result);\n      strapiGoogleAuth(userCredential.accessToken);\n      Router.push('/');\n    }).catch(error => {\n      const credential = GoogleAuthProvider.credentialFromError(error);\n      errorResult = {\n        error: true,\n        data: error.code\n      };\n      console.warn('Credential From error: ', credential);\n      console.warn('Email: ', error.email);\n      console.warn(error.message);\n    });\n    return errorResult;\n  } //logout\n\n\n  async function logOut() {\n    await signOut(auth).then(() => {\n      Cookies.remove('strapiToken');\n      Cookies.remove('strapiUser');\n      setUser(false);\n      setCart([]);\n      Router.push('/');\n    }).catch(error => {\n      console.warn('Logout error: ', error);\n    });\n  } //// Cart Section ////\n  // add item\n\n\n  function addOneToCart(item) {\n    let newCart = cart;\n    const itemInCart = newCart.find(cartItem => cartItem.id === item.id);\n\n    if (itemInCart !== undefined) {\n      const index = newCart.indexOf(itemInCart);\n      newCart[index].quantity++;\n      console.log('Context newCart add: ', newCart);\n    } else {\n      let newItem = _objectSpread({}, item);\n\n      newItem.quantity = 1;\n      newCart.push(newItem);\n      console.log('Context newCart add: ', newCart);\n    }\n\n    const cartData = JSON.stringify(newCart);\n    Cookies.set(`${user.id}cart`, cartData);\n    setCart([...newCart]);\n  } // test for state change\n  // setTimeout(() => setCart([{id: 1234}, {id: 2345}, {id: 3456}]), 2000)\n  // remove item\n\n\n  function removeOneFromCart(item) {\n    let newCart = cart;\n    const itemInCart = newCart.find(cartItem => cartItem.id === item.id);\n\n    if (itemInCart.quantity > 1) {\n      const index = newCart.indexOf(itemInCart);\n      newCart[index].quantity--;\n      console.log('Context newCart remove: ', newCart);\n    } else {\n      const index = newCart.indexOf(item);\n      newCart.splice(index, 1);\n      console.log('Context newCart remove: ', newCart);\n    }\n\n    setCart([...newCart]); // update/remove cart cookie\n\n    const cartData = JSON.stringify(newCart);\n\n    if (newCart.length === 0) {\n      Cookies.remove(`${user.id}cart`);\n    } else {\n      Cookies.set(`${user.id}cart`, cartData);\n    }\n  } // delete item\n\n\n  function deleteAllOfOneItemFromCart(item) {\n    let newCart = cart;\n    const index = newCart.indexOf(item);\n    newCart.splice(index, 1);\n    console.log('Context newCart delete: ', newCart);\n    setCart([...newCart]); // update/remove cart cookie\n\n    const cartData = JSON.stringify(newCart);\n\n    if (newCart.length === 0) {\n      Cookies.remove(`${user.id}cart`);\n    } else {\n      Cookies.set(`${user.id}cart`, cartData);\n    }\n  } //// Successful Checkout ////\n\n\n  function successfulCheckout() {\n    Cookies.remove(`${user.id}cart`);\n    setCart([]);\n  } //// Initial Setup ////\n  // check to see if the variable contains valid JSON data\n\n\n  function jsonDataTrue(string) {\n    let jsonData;\n\n    try {\n      jsonData = JSON.parse(string);\n    } catch (error) {\n      return false;\n    }\n\n    return jsonData;\n  } // change restaurant id for dishes page.\n\n\n  function changeRestaurantID(id) {\n    setRestaurantID(id);\n  } // check cookies for existing session data\n\n\n  useEffect(() => {\n    // get authentication and authorization data from session cookies\n    const strapiUserData = Cookies.get('strapiUser');\n    const strapiUserDataObject = jsonDataTrue(strapiUserData);\n\n    if (strapiUserDataObject) {\n      console.log('Context Strapi User: ', strapiUserDataObject);\n      setUser(_objectSpread({}, strapiUserDataObject));\n    }\n\n    setAuthenticationLoading(false);\n  }, []);\n  useEffect(() => {\n    // get cart data from session cookie\n    const cartData = Cookies.get(`${user.id}cart`);\n    const cartDataObject = jsonDataTrue(cartData);\n\n    if (cartDataObject) {\n      setCart([...cartDataObject]);\n    }\n  }, [user]); //// Context Values ////\n\n  const contextValues = {\n    user,\n    authenticationLoading,\n    createAccount,\n    login,\n    googleSignIn,\n    logOut,\n    restaurantID,\n    changeRestaurantID,\n    cart,\n    addOneToCart,\n    removeOneFromCart,\n    deleteAllOfOneItemFromCart,\n    successfulCheckout\n  }; //// Context Provider ////\n\n  return __jsx(AppContext.Provider, {\n    value: contextValues,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 5\n    }\n  }, children);\n}","map":{"version":3,"sources":["/Users/Tim/Desktop/graphqlapollo/components/context.js"],"names":["createContext","useContext","useState","useEffect","context","AppContext","ContextProvider","children","user","setUser","authenticationLoading","setAuthenticationLoading","restaurantID","setRestaurantID","cart","setCart","auth","getAuth","provider","GoogleAuthProvider","API_URL","process","env","NEXT_PUBLIC_STRAPI_API_URL","createAccount","username","email","password","errorResult","axios","post","then","result","error","Cookies","set","data","jwt","userData","JSON","stringify","console","log","catch","warn","login","identifier","Router","push","strapiGoogleAuth","accessToken","get","googleSignIn","signInWithPopup","userCredential","credentialFromResult","credential","credentialFromError","code","message","logOut","signOut","remove","addOneToCart","item","newCart","itemInCart","find","cartItem","id","undefined","index","indexOf","quantity","newItem","cartData","removeOneFromCart","splice","length","deleteAllOfOneItemFromCart","successfulCheckout","jsonDataTrue","string","jsonData","parse","changeRestaurantID","strapiUserData","strapiUserDataObject","cartDataObject","contextValues"],"mappings":";;;;;;;;;;AAAA,SAASA,aAAT,EAAwBC,UAAxB,EAAoCC,QAApC,EAA8CC,SAA9C,QAA+D,OAA/D;AAGA,OAAO,SAASC,OAAT,GAAmB;AACxB,SAAOH,UAAU,CAACI,UAAD,CAAjB;AACD;AAED,OAAO,SAASC,eAAT,CAAyB;AAAEC,EAAAA;AAAF,CAAzB,EAAuC;AAC5C,QAAM;AAAA,OAACC,IAAD;AAAA,OAAOC;AAAP,MAAkBP,QAAQ,CAAC,KAAD,CAAhC;AACA,QAAM;AAAA,OAACQ,qBAAD;AAAA,OAAwBC;AAAxB,MAAoDT,QAAQ,CAAC,IAAD,CAAlE;AACA,QAAM;AAAA,OAACU,YAAD;AAAA,OAAeC;AAAf,MAAkCX,QAAQ,CAAC,KAAD,CAAhD;AACA,QAAM;AAAA,OAACY,IAAD;AAAA,OAAOC;AAAP,MAAkBb,QAAQ,CAAC,EAAD,CAAhC,CAJ4C,CAM5C;AACA;AAEA;AACA;;AACA,QAAMc,IAAI,GAAGC,OAAO,EAApB;AACA,QAAMC,QAAQ,GAAG,IAAIC,kBAAJ,EAAjB,CAZ4C,CAc5C;;AACA,QAAMC,OAAO,GAAGC,OAAO,CAACC,GAAR,CAAYC,0BAAZ,IAA0C,uBAA1D,CAf4C,CAiB5C;;AACA,iBAAeC,aAAf,CAA6BC,QAA7B,EAAuCC,KAAvC,EAA8CC,QAA9C,EAAwD;AACtD;AACA,cAAmC;AACjC;AACD;;AAED,QAAIC,WAAW,GAAG,EAAlB;AAEA,UAAMC,KAAK,CACRC,IADG,CACG,GAAEV,OAAQ,sBADb,EACoC;AAAEK,MAAAA,QAAF;AAAYC,MAAAA,KAAZ;AAAmBC,MAAAA;AAAnB,KADpC,EAEHI,IAFG,CAEEC,MAAM,IAAI;AACdJ,MAAAA,WAAW,GAAG;AAAEK,QAAAA,KAAK,EAAE;AAAT,OAAd,CADc,CAEd;;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BH,MAAM,CAACI,IAAP,CAAYC,GAAvC;AACA,YAAMC,QAAQ,GAAGC,IAAI,CAACC,SAAL,CAAeR,MAAM,CAACI,IAAP,CAAY5B,IAA3B,CAAjB;AACA0B,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BG,QAA1B,EALc,CAMd;;AACAG,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCV,MAAM,CAACI,IAA5C;AACA3B,MAAAA,OAAO,CAACuB,MAAM,CAACI,IAAP,CAAY5B,IAAb,CAAP;AACD,KAXG,EAYHmC,KAZG,CAYGV,KAAK,IAAI;AACdQ,MAAAA,OAAO,CAACG,IAAR,CAAaX,KAAb;AACAL,MAAAA,WAAW,GAAG;AAAEK,QAAAA,KAAK,EAAE,IAAT;AAAeG,QAAAA,IAAI,EAAE;AAArB,OAAd;AACD,KAfG,CAAN;AAiBA,WAAOR,WAAP;AACD,GA5C2C,CA8C5C;;;AACA,iBAAeiB,KAAf,CAAqBC,UAArB,EAAiCnB,QAAjC,EAA2C;AACzC;AACA,cAAmC;AACjC;AACD;;AAED,QAAIC,WAAJ;AAEA,UAAMC,KAAK,CACRC,IADG,CACG,GAAEV,OAAQ,aADb,EAC2B;AAAE0B,MAAAA,UAAF;AAAcnB,MAAAA;AAAd,KAD3B,EAEHI,IAFG,CAEEC,MAAM,IAAI;AACdJ,MAAAA,WAAW,GAAG;AAAEK,QAAAA,KAAK,EAAE;AAAT,OAAd,CADc,CAEd;;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BH,MAAM,CAACI,IAAP,CAAYC,GAAvC;AACA,YAAMC,QAAQ,GAAGC,IAAI,CAACC,SAAL,CAAeR,MAAM,CAACI,IAAP,CAAY5B,IAA3B,CAAjB;AACA0B,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BG,QAA1B,EALc,CAMd;;AACAG,MAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ,EAAmCV,MAAM,CAACI,IAA1C;AACA3B,MAAAA,OAAO,CAACuB,MAAM,CAACI,IAAP,CAAY5B,IAAb,CAAP;AACAuC,MAAAA,MAAM,CAACC,IAAP,CAAY,GAAZ;AACD,KAZG,EAaHL,KAbG,CAaGV,KAAK,IAAI;AACdQ,MAAAA,OAAO,CAACG,IAAR,CAAaX,KAAb;AACAL,MAAAA,WAAW,GAAG;AAAEK,QAAAA,KAAK,EAAE,IAAT;AAAeG,QAAAA,IAAI,EAAE;AAArB,OAAd;AACD,KAhBG,CAAN;AAkBA,WAAOR,WAAP;AACD,GA1E2C,CA4E5C;;;AACA,iBAAeqB,gBAAf,CAAgCC,WAAhC,EAA6C;AAC3C;AACA,cAAmC;AACjC;AACD;;AAED,UAAMrB,KAAK,CACRsB,GADG,CACE,GAAE/B,OAAQ,sCAAqC8B,WAAY,EAD7D,EAEHnB,IAFG,CAEGC,MAAD,IAAY;AAChB;AACA;AACAE,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BH,MAAM,CAACI,IAAP,CAAYC,GAAvC;AACA,YAAMC,QAAQ,GAAGC,IAAI,CAACC,SAAL,CAAeR,MAAM,CAACI,IAAP,CAAY5B,IAA3B,CAAjB;AACA0B,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BG,QAA1B;AACA7B,MAAAA,OAAO,CAACuB,MAAM,CAACI,IAAP,CAAY5B,IAAb,CAAP;AACAiC,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCV,MAAM,CAACI,IAA5C;AACD,KAVG,EAWHO,KAXG,CAWGV,KAAK,IAAI;AACdQ,MAAAA,OAAO,CAACG,IAAR,CAAaX,KAAb;AACD,KAbG,CAAN;AAcD,GAjG2C,CAmG5C;;;AACA,iBAAemB,YAAf,GAA8B;AAC5B;AACA,cAAmC;AACjC;AACD;;AAED,QAAIxB,WAAJ;AAEA,UAAMyB,eAAe,CAACrC,IAAD,EAAOE,QAAP,CAAf,CACHa,IADG,CACEC,MAAM,IAAI;AACdJ,MAAAA,WAAW,GAAG;AAAEK,QAAAA,KAAK,EAAE;AAAT,OAAd;AACA,YAAMqB,cAAc,GAAGnC,kBAAkB,CAACoC,oBAAnB,CAAwCvB,MAAxC,CAAvB,CAFc,CAGd;AACA;AACA;;AACAS,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCV,MAArC;AACAiB,MAAAA,gBAAgB,CAACK,cAAc,CAACJ,WAAhB,CAAhB;AACAH,MAAAA,MAAM,CAACC,IAAP,CAAY,GAAZ;AACD,KAVG,EAWHL,KAXG,CAWGV,KAAK,IAAI;AACd,YAAMuB,UAAU,GAAGrC,kBAAkB,CAACsC,mBAAnB,CAAuCxB,KAAvC,CAAnB;AACAL,MAAAA,WAAW,GAAG;AAAEK,QAAAA,KAAK,EAAE,IAAT;AAAeG,QAAAA,IAAI,EAAEH,KAAK,CAACyB;AAA3B,OAAd;AACAjB,MAAAA,OAAO,CAACG,IAAR,CAAa,yBAAb,EAAwCY,UAAxC;AACAf,MAAAA,OAAO,CAACG,IAAR,CAAa,SAAb,EAAwBX,KAAK,CAACP,KAA9B;AACAe,MAAAA,OAAO,CAACG,IAAR,CAAaX,KAAK,CAAC0B,OAAnB;AACD,KAjBG,CAAN;AAmBA,WAAO/B,WAAP;AACD,GAhI2C,CAkI5C;;;AACA,iBAAegC,MAAf,GAAwB;AACtB,UAAMC,OAAO,CAAC7C,IAAD,CAAP,CACHe,IADG,CACE,MAAM;AACVG,MAAAA,OAAO,CAAC4B,MAAR,CAAe,aAAf;AACA5B,MAAAA,OAAO,CAAC4B,MAAR,CAAe,YAAf;AACArD,MAAAA,OAAO,CAAC,KAAD,CAAP;AACAM,MAAAA,OAAO,CAAC,EAAD,CAAP;AACAgC,MAAAA,MAAM,CAACC,IAAP,CAAY,GAAZ;AACD,KAPG,EAQHL,KARG,CAQIV,KAAD,IAAW;AAChBQ,MAAAA,OAAO,CAACG,IAAR,CAAa,gBAAb,EAA+BX,KAA/B;AACD,KAVG,CAAN;AAWD,GA/I2C,CAkJ5C;AACA;;;AACA,WAAS8B,YAAT,CAAsBC,IAAtB,EAA4B;AAC1B,QAAIC,OAAO,GAAGnD,IAAd;AACA,UAAMoD,UAAU,GAAGD,OAAO,CAACE,IAAR,CAAaC,QAAQ,IAAIA,QAAQ,CAACC,EAAT,KAAgBL,IAAI,CAACK,EAA9C,CAAnB;;AACA,QAAIH,UAAU,KAAKI,SAAnB,EAA8B;AAC5B,YAAMC,KAAK,GAAGN,OAAO,CAACO,OAAR,CAAgBN,UAAhB,CAAd;AACAD,MAAAA,OAAO,CAACM,KAAD,CAAP,CAAeE,QAAf;AACAhC,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCuB,OAArC;AACD,KAJD,MAIO;AACL,UAAIS,OAAO,qBAAOV,IAAP,CAAX;;AACAU,MAAAA,OAAO,CAACD,QAAR,GAAmB,CAAnB;AACAR,MAAAA,OAAO,CAACjB,IAAR,CAAa0B,OAAb;AACAjC,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCuB,OAArC;AACD;;AACD,UAAMU,QAAQ,GAAGpC,IAAI,CAACC,SAAL,CAAeyB,OAAf,CAAjB;AACA/B,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAE3B,IAAI,CAAC6D,EAAG,MAAvB,EAA8BM,QAA9B;AACA5D,IAAAA,OAAO,CAAC,CAAC,GAAGkD,OAAJ,CAAD,CAAP;AACD,GApK2C,CAsK5C;AACA;AAEA;;;AACA,WAASW,iBAAT,CAA2BZ,IAA3B,EAAiC;AAC/B,QAAIC,OAAO,GAAGnD,IAAd;AACA,UAAMoD,UAAU,GAAGD,OAAO,CAACE,IAAR,CAAaC,QAAQ,IAAIA,QAAQ,CAACC,EAAT,KAAgBL,IAAI,CAACK,EAA9C,CAAnB;;AACA,QAAIH,UAAU,CAACO,QAAX,GAAsB,CAA1B,EAA6B;AAC3B,YAAMF,KAAK,GAAGN,OAAO,CAACO,OAAR,CAAgBN,UAAhB,CAAd;AACAD,MAAAA,OAAO,CAACM,KAAD,CAAP,CAAeE,QAAf;AACAhC,MAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ,EAAwCuB,OAAxC;AACD,KAJD,MAIO;AACL,YAAMM,KAAK,GAAGN,OAAO,CAACO,OAAR,CAAgBR,IAAhB,CAAd;AACAC,MAAAA,OAAO,CAACY,MAAR,CAAeN,KAAf,EAAsB,CAAtB;AACA9B,MAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ,EAAwCuB,OAAxC;AACD;;AACDlD,IAAAA,OAAO,CAAC,CAAC,GAAGkD,OAAJ,CAAD,CAAP,CAZ+B,CAc/B;;AACA,UAAMU,QAAQ,GAAGpC,IAAI,CAACC,SAAL,CAAeyB,OAAf,CAAjB;;AACA,QAAIA,OAAO,CAACa,MAAR,KAAmB,CAAvB,EAA0B;AACxB5C,MAAAA,OAAO,CAAC4B,MAAR,CAAgB,GAAEtD,IAAI,CAAC6D,EAAG,MAA1B;AACD,KAFD,MAEO;AACLnC,MAAAA,OAAO,CAACC,GAAR,CAAa,GAAE3B,IAAI,CAAC6D,EAAG,MAAvB,EAA8BM,QAA9B;AACD;AACF,GA/L2C,CAiM5C;;;AACA,WAASI,0BAAT,CAAoCf,IAApC,EAA0C;AACxC,QAAIC,OAAO,GAAGnD,IAAd;AACA,UAAMyD,KAAK,GAAGN,OAAO,CAACO,OAAR,CAAgBR,IAAhB,CAAd;AACAC,IAAAA,OAAO,CAACY,MAAR,CAAeN,KAAf,EAAsB,CAAtB;AACA9B,IAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ,EAAwCuB,OAAxC;AACAlD,IAAAA,OAAO,CAAC,CAAC,GAAGkD,OAAJ,CAAD,CAAP,CALwC,CAOxC;;AACA,UAAMU,QAAQ,GAAGpC,IAAI,CAACC,SAAL,CAAeyB,OAAf,CAAjB;;AACA,QAAIA,OAAO,CAACa,MAAR,KAAmB,CAAvB,EAA0B;AACxB5C,MAAAA,OAAO,CAAC4B,MAAR,CAAgB,GAAEtD,IAAI,CAAC6D,EAAG,MAA1B;AACD,KAFD,MAEO;AACLnC,MAAAA,OAAO,CAACC,GAAR,CAAa,GAAE3B,IAAI,CAAC6D,EAAG,MAAvB,EAA8BM,QAA9B;AACD;AACF,GAhN2C,CAkN5C;;;AACA,WAASK,kBAAT,GAA8B;AAC5B9C,IAAAA,OAAO,CAAC4B,MAAR,CAAgB,GAAEtD,IAAI,CAAC6D,EAAG,MAA1B;AACAtD,IAAAA,OAAO,CAAC,EAAD,CAAP;AACD,GAtN2C,CAwN5C;AACA;;;AACA,WAASkE,YAAT,CAAsBC,MAAtB,EAA8B;AAC5B,QAAIC,QAAJ;;AACA,QAAI;AACFA,MAAAA,QAAQ,GAAG5C,IAAI,CAAC6C,KAAL,CAAWF,MAAX,CAAX;AACD,KAFD,CAEE,OAAOjD,KAAP,EAAc;AACd,aAAO,KAAP;AACD;;AACD,WAAOkD,QAAP;AACD,GAlO2C,CAoO5C;;;AACA,WAASE,kBAAT,CAA4BhB,EAA5B,EAAgC;AAC9BxD,IAAAA,eAAe,CAACwD,EAAD,CAAf;AACD,GAvO2C,CAyO5C;;;AACAlE,EAAAA,SAAS,CAAC,MAAM;AACd;AACA,UAAMmF,cAAc,GAAGpD,OAAO,CAACiB,GAAR,CAAY,YAAZ,CAAvB;AACA,UAAMoC,oBAAoB,GAAGN,YAAY,CAACK,cAAD,CAAzC;;AACA,QAAIC,oBAAJ,EAA0B;AACxB9C,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqC6C,oBAArC;AACA9E,MAAAA,OAAO,mBAAK8E,oBAAL,EAAP;AACD;;AAED5E,IAAAA,wBAAwB,CAAC,KAAD,CAAxB;AACD,GAVQ,EAUN,EAVM,CAAT;AAYAR,EAAAA,SAAS,CAAC,MAAM;AACd;AACA,UAAMwE,QAAQ,GAAGzC,OAAO,CAACiB,GAAR,CAAa,GAAE3C,IAAI,CAAC6D,EAAG,MAAvB,CAAjB;AACA,UAAMmB,cAAc,GAAGP,YAAY,CAACN,QAAD,CAAnC;;AACA,QAAIa,cAAJ,EAAoB;AAClBzE,MAAAA,OAAO,CAAC,CAAC,GAAGyE,cAAJ,CAAD,CAAP;AACD;AACF,GAPQ,EAON,CAAChF,IAAD,CAPM,CAAT,CAtP4C,CA+P5C;;AACA,QAAMiF,aAAa,GAAG;AACpBjF,IAAAA,IADoB;AAEpBE,IAAAA,qBAFoB;AAGpBc,IAAAA,aAHoB;AAIpBqB,IAAAA,KAJoB;AAKpBO,IAAAA,YALoB;AAMpBQ,IAAAA,MANoB;AAOpBhD,IAAAA,YAPoB;AAQpByE,IAAAA,kBARoB;AASpBvE,IAAAA,IAToB;AAUpBiD,IAAAA,YAVoB;AAWpBa,IAAAA,iBAXoB;AAYpBG,IAAAA,0BAZoB;AAapBC,IAAAA;AAboB,GAAtB,CAhQ4C,CAgR5C;;AACA,SACE,MAAC,UAAD,CAAY,QAAZ;AAAqB,IAAA,KAAK,EAAGS,aAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGlF,QADH,CADF;AAKD","sourcesContent":["import { createContext, useContext, useState, useEffect } from 'react';\n\n\nexport function context() {\n  return useContext(AppContext);\n}\n\nexport function ContextProvider({ children }) {\n  const [user, setUser] = useState(false);\n  const [authenticationLoading, setAuthenticationLoading] = useState(true);\n  const [restaurantID, setRestaurantID] = useState(false);\n  const [cart, setCart] = useState([]);\n\n  // remove cookies for testing.\n  // Cookies.remove('cart');\n\n  //// Authentication Section ////\n  // set up Firebase Goggle authentication\n  const auth = getAuth();\n  const provider = new GoogleAuthProvider();\n\n  // set Strapi URL\n  const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || \"http://localhost:1337\";\n\n  // create an account\n  async function createAccount(username, email, password) {\n    // prevent this function from being run on a server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    let errorResult = {};\n\n    await axios\n      .post(`${API_URL}/auth/local/register`, { username, email, password })\n      .then(result => {\n        errorResult = { error: false };\n        // Set user cookies\n        Cookies.set('strapiToken', result.data.jwt);\n        const userData = JSON.stringify(result.data.user);\n        Cookies.set('strapiUser', userData);\n        // console.log('Context Strapi JWT: ', result.data.jwt);\n        console.log('Context Strapi Data: ', result.data);\n        setUser(result.data.user);\n      })\n      .catch(error => {\n        console.warn(error);\n        errorResult = { error: true, data: 'The username or email you chose is already in use. Please try something else.' };\n      })\n\n    return errorResult;\n  }\n\n  // login\n  async function login(identifier, password) {\n    // prevent this function from being run on a server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    let errorResult;\n\n    await axios\n      .post(`${API_URL}/auth/local`, { identifier, password })\n      .then(result => {\n        errorResult = { error: false };\n        // Set user cookies\n        Cookies.set('strapiToken', result.data.jwt);\n        const userData = JSON.stringify(result.data.user);\n        Cookies.set('strapiUser', userData);\n        // console.log('Context Strapi JWT: ', result.data.jwt);\n        console.log('Context Result Data', result.data);\n        setUser(result.data.user);\n        Router.push('/');\n      })\n      .catch(error => {\n        console.warn(error);\n        errorResult = { error: true, data: 'Incorrect email or password' };\n      })\n\n    return errorResult;\n  }\n\n  // Strapi authentication after Google sign in\n  async function strapiGoogleAuth(accessToken) {\n    // prevent this function from being run on a server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    await axios\n      .get(`${API_URL}/auth/google/callback?access_token=${accessToken}`)\n      .then((result) => {\n        // console.log('Context Strapi JWT: ', result.data.jwt)\n        // Set user cookies\n        Cookies.set('strapiToken', result.data.jwt);\n        const userData = JSON.stringify(result.data.user);\n        Cookies.set('strapiUser', userData);\n        setUser(result.data.user);\n        console.log('Context Strapi Data: ', result.data);\n      })\n      .catch(error => {\n        console.warn(error);\n      })\n  }\n\n  // sign in with Google\n  async function googleSignIn() {\n    // prevent this function from being run on a server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    let errorResult;\n\n    await signInWithPopup(auth, provider)\n      .then(result => {\n        errorResult = { error: false }\n        const userCredential = GoogleAuthProvider.credentialFromResult(result);\n        // console.log('Context User Credential: ', userCredential);\n        // const token = credential.accessToken;\n        // console.log('Context Token: ', token);\n        console.log('Context Google Data: ', result);\n        strapiGoogleAuth(userCredential.accessToken)\n        Router.push('/');\n      })\n      .catch(error => {\n        const credential = GoogleAuthProvider.credentialFromError(error);\n        errorResult = { error: true, data: error.code };\n        console.warn('Credential From error: ', credential)\n        console.warn('Email: ', error.email)\n        console.warn(error.message);\n      })\n\n    return errorResult;\n  }\n\n  //logout\n  async function logOut() {\n    await signOut(auth)\n      .then(() => {\n        Cookies.remove('strapiToken');\n        Cookies.remove('strapiUser');\n        setUser(false);\n        setCart([]);\n        Router.push('/');\n      })\n      .catch((error) => {\n        console.warn('Logout error: ', error);\n      });\n  }\n\n\n  //// Cart Section ////\n  // add item\n  function addOneToCart(item) {\n    let newCart = cart;\n    const itemInCart = newCart.find(cartItem => cartItem.id === item.id);\n    if (itemInCart !== undefined) {\n      const index = newCart.indexOf(itemInCart);\n      newCart[index].quantity ++;\n      console.log('Context newCart add: ', newCart);\n    } else {\n      let newItem = {...item};\n      newItem.quantity = 1;\n      newCart.push(newItem);\n      console.log('Context newCart add: ', newCart);\n    }\n    const cartData = JSON.stringify(newCart);\n    Cookies.set(`${user.id}cart`, cartData)\n    setCart([...newCart]);\n  }\n\n  // test for state change\n  // setTimeout(() => setCart([{id: 1234}, {id: 2345}, {id: 3456}]), 2000)\n\n  // remove item\n  function removeOneFromCart(item) {\n    let newCart = cart;\n    const itemInCart = newCart.find(cartItem => cartItem.id === item.id);\n    if (itemInCart.quantity > 1) {\n      const index = newCart.indexOf(itemInCart);\n      newCart[index].quantity --;\n      console.log('Context newCart remove: ', newCart);\n    } else {\n      const index = newCart.indexOf(item);\n      newCart.splice(index, 1);\n      console.log('Context newCart remove: ', newCart);\n    }\n    setCart([...newCart]);\n\n    // update/remove cart cookie\n    const cartData = JSON.stringify(newCart);\n    if (newCart.length === 0) {\n      Cookies.remove(`${user.id}cart`);\n    } else {\n      Cookies.set(`${user.id}cart`, cartData);\n    }\n  }\n\n  // delete item\n  function deleteAllOfOneItemFromCart(item) {\n    let newCart = cart;\n    const index = newCart.indexOf(item);\n    newCart.splice(index, 1);\n    console.log('Context newCart delete: ', newCart)\n    setCart([...newCart]);\n\n    // update/remove cart cookie\n    const cartData = JSON.stringify(newCart);\n    if (newCart.length === 0) {\n      Cookies.remove(`${user.id}cart`);\n    } else {\n      Cookies.set(`${user.id}cart`, cartData);\n    }\n  }\n\n  //// Successful Checkout ////\n  function successfulCheckout() {\n    Cookies.remove(`${user.id}cart`);\n    setCart([]);\n  }\n\n  //// Initial Setup ////\n  // check to see if the variable contains valid JSON data\n  function jsonDataTrue(string) {\n    let jsonData;\n    try {\n      jsonData = JSON.parse(string);\n    } catch (error) {\n      return false;\n    }\n    return jsonData;\n  }\n\n  // change restaurant id for dishes page.\n  function changeRestaurantID(id) {\n    setRestaurantID(id);\n  }\n\n  // check cookies for existing session data\n  useEffect(() => {\n    // get authentication and authorization data from session cookies\n    const strapiUserData = Cookies.get('strapiUser');\n    const strapiUserDataObject = jsonDataTrue(strapiUserData);\n    if (strapiUserDataObject) {\n      console.log('Context Strapi User: ', strapiUserDataObject);\n      setUser({...strapiUserDataObject});\n    }\n\n    setAuthenticationLoading(false);\n  }, []);\n\n  useEffect(() => {\n    // get cart data from session cookie\n    const cartData = Cookies.get(`${user.id}cart`);\n    const cartDataObject = jsonDataTrue(cartData);\n    if (cartDataObject) {\n      setCart([...cartDataObject]);\n    }\n  }, [user]);\n\n  //// Context Values ////\n  const contextValues = {\n    user,\n    authenticationLoading,\n    createAccount,\n    login,\n    googleSignIn,\n    logOut,\n    restaurantID,\n    changeRestaurantID,\n    cart,\n    addOneToCart,\n    removeOneFromCart,\n    deleteAllOfOneItemFromCart,\n    successfulCheckout\n  }\n\n  //// Context Provider ////\n  return (\n    <AppContext.Provider value={ contextValues }>\n      {children}\n    </AppContext.Provider>\n  );\n}"]},"metadata":{},"sourceType":"module"}